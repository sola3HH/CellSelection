<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title></title>
    <script src="js/vue.js" type="text/javascript" charset="utf-8">
    </script>
    <link rel="stylesheet" href="leaflet/leaflet.css"/>
    <script src="leaflet/leaflet.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"></script>
</head>

<body style="background-color: #273c75;">
<h1 id="title">Cell Selection Simulation</h1>
<div id="mainGroup">
    <div class="row" style="margin: 0 0.5rem;">
        <div id="map" class="col-6"></div>


        <div class="col-6">
            <div class="card configCard">
                <div class="card-body">
                    <h2 class="card-title">Control center</h2>

                    <!--Avatar's status-->
                    <div id="AvatarStatus">
                        <h3>Avatar Status</h3>
                        <p>The antenna linked :<span style="color: blueviolet;">{{antennaNumber}}</span></p>
                        <p>Connect Power:</p>
                        <!--TODO: For connect power, use progress bar to show the value. -->
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped bg-info" role="progressbar"
                                 style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>

                    <!--Simulation Process status-->
                    <div id="StartSimulation">
                        <h3>Simulation Parameters</h3>
                        <div>
                            <p>Handover type:</p>
                            <p>{{ handover }}</p>
                            <!--Get value by name attributes, use DOM elements-->
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="customRadioInline1" name="handoverType"
                                       class="custom-control-input" value="hard">
                                <label class="custom-control-label" for="customRadioInline1">Hard Handover</label>
                            </div>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="customRadioInline2" name="handoverType"
                                       class="custom-control-input" value="soft">
                                <label class="custom-control-label" for="customRadioInline2">Soft Handover</label>
                            </div>
                        </div>

                        <a href="#" class="btn btn-primary" v-on:click="Start">Start</a>

                    </div>

                </div>
            </div>
        </div>

    </div>
</div>


<script type="text/javascript" src="js/scripts.js"></script>
<script>

    //Avatar Status
    var AvatarStat = new Vue({
        el: '#AvatarStatus',
        data: {
            //Indicate the antenna connect to, and the intensity of all.
            signalIntensity: 0,
            antennaNumber: -1
        },
        methods: {}
    })
    //Start Simulation button
    var StartSimu = new Vue({
        el: '#StartSimulation',
        data: {
            speed: 1,
            handover: 'unknown'
        },
        methods: {
            Start() {
                //TODO: identify the handover type: Then disable the radio group.
                var handoverRadios = document.getElementsByName('handoverType');
                for (var handoverType of handoverRadios) {
                    if (handoverType.checked) {
                        this.handover = handoverType.value;
                    }
                }

                var init_position = Path[0];
                var avatar = L.marker(init_position).addTo(mymap);
                setInterval(function () {
                    //TODO: move avatar to next position

                }, 3000);
                var flag = 1;
                var i = -1;
                var position = Path[0];

                //Do not control avatar's position here. Use setInterval to control the animation.
                while (flag === 1) {
                    i++;
                    avatar.setLatLng(Path[i]);

                    //selection
                    if (AvatarStat.antennaNumber === -1) {
                        //at least in a range of a tower
                        if (isInRange(position)) {
                            //in the cross area of 2 or more tower
                            if (isInCorssArea(position)) {
                                var nums_antenna = crossAntennaNumber(position);
                                var intensity = signalIntensity(position, polyCenters[num_antenna[0]]);
                                var best_antenna = num_antenna[0];
                                //Compare all the intensities of antennas and choose the best one
                                for (var j = 1; j < num_antenna.length; j++) {
                                    if (signalIntensity(position, num_antenna[j]) > intensity) {
                                        intensity = signalIntensity(position, polyCenters[num_antenna[j]]);
                                        best_antenna = num_antenna[j];
                                    }
                                }
                                AvatarStat.signalIntensity = intensity;
                                AvatarStat.antennaNumber = best_antenna;
                                $("#title").html("The signal intensity = " + intensity + ", connected to antenna: " + best_antenna);
                            }
                            //not in the cross area
                            else {
                                var num_antenna = singleAntennaNumber(position);
                                var intensity = signalIntensity(position, polyCenters[num_antenna]);
								AvatarStat.signalIntensity = intensity;
								AvatarStat.antennaNumber = num_antenna;
                                $("#title").html("The signal intensity = " + intensity + ", connected to antenna: " + num_antenna);
                            }
                        }
                    }

                }
            },
            getIntensity() {

            }
        }
    })


</script>
</body>

</html>